import{a as O}from"./chunk-SR7JJWDK.js";import{a as F}from"./chunk-2EQVSMUF.js";import{a as hi}from"./chunk-EPQ6NRZE.js";import{$a as ai,B as d,D as M,E as a,Ea as D,F as n,G as u,H as k,I as H,Ia as Q,Ja as Y,K as j,Ka as B,L as f,La as J,O as l,Oa as K,P as C,Pa as W,Q as m,Qa as X,R as z,Ra as Z,Sa as ii,Ta as h,Ua as ei,Va as oi,Wa as ti,Ya as v,_a as ni,ab as ri,ba as U,bb as li,c as g,ca as L,cb as di,da as G,db as si,eb as ci,fb as pi,gb as ui,h as y,jb as mi,ka as R,kb as fi,l as P,lb as x,m as I,mb as gi,w as A,x as r,y as b,z as p}from"./chunk-XMWGSLYE.js";function Ii(t,o){if(t&1&&(a(0,"option",12),l(1),n()),t&2){let e=o.$implicit;d("value",e),r(),m(" ",e," ")}}function Mi(t,o){t&1&&(a(0,"div")(1,"small",13),l(2,"Este campo es obligatorio."),n()())}function Li(t,o){if(t&1&&(a(0,"option",12),l(1),n()),t&2){let e=o.$implicit;d("value",e),r(),C(e)}}function Di(t,o){if(t&1&&(a(0,"option",12),l(1),n()),t&2){let e=o.$implicit;d("value",e),r(),C(e)}}function Oi(t,o){t&1&&(a(0,"div")(1,"small",13),l(2,"La hora de fin debe ser mayor que la hora de inicio."),n()())}function Fi(t,o){if(t&1&&(a(0,"div")(1,"label"),l(2,"Franja Horaria:"),n(),a(3,"div",14)(4,"div",15)(5,"label"),l(6,"Hora de Inicio:"),n(),a(7,"select",16),p(8,Li,2,2,"option",7),n(),a(9,"label"),l(10,"Hora de Fin:"),n(),a(11,"select",17),p(12,Di,2,2,"option",7),n(),p(13,Oi,3,0,"div",8),n()()()),t&2){let e=f(2);r(8),d("ngForOf",e.horas),r(4),d("ngForOf",e.horas),r(),d("ngIf",e.form.hasError("finMenorQueInicio"))}}function Ti(t,o){t&1&&(a(0,"div")(1,"small",13),l(2,"Este campo es obligatorio."),n()())}function wi(t,o){if(t&1&&(a(0,"div")(1,"small",13),l(2),n()()),t&2){let e=f(2);r(2),m("Debe ser m\xEDnimo ",e.duracionTurnos==null?null:e.duracionTurnos.getError("min").min," minutos.")}}function Ni(t,o){if(t&1&&(a(0,"div")(1,"small",13),l(2),n()()),t&2){let e=f(2);r(2),m("Debe ser m\xE1ximo ",e.duracionTurnos==null?null:e.duracionTurnos.getError("max").max," minutos.")}}function Ai(t,o){if(t&1&&(a(0,"div",3)(1,"label",4),l(2,"Especialidad"),n(),a(3,"select",5)(4,"option",6),l(5,"Elige..."),n(),p(6,Ii,2,2,"option",7),n(),p(7,Mi,3,0,"div",8),n(),p(8,Fi,14,3,"div",8),a(9,"div",9)(10,"label"),l(11,"Duraci\xF3n de los turnos:"),n(),u(12,"input",10),p(13,Ti,3,0,"div",8)(14,wi,3,1,"div",8)(15,Ni,3,1,"div",8),n(),a(16,"button",11),l(17," Guardar "),n()),t&2){let e,i=f();r(6),d("ngForOf",i.usuarioLogueadoEntidad.especialidades),r(),d("ngIf",(i.especialidad==null?null:i.especialidad.hasError("required"))&&(i.especialidad==null?null:i.especialidad.touched)),r(),d("ngIf",(e=i.form.get("especialidad"))==null?null:e.value),r(5),d("ngIf",(i.duracionTurnos==null?null:i.duracionTurnos.hasError("required"))&&(i.duracionTurnos==null?null:i.duracionTurnos.touched)),r(),d("ngIf",(i.duracionTurnos==null?null:i.duracionTurnos.hasError("min"))&&(i.duracionTurnos==null?null:i.duracionTurnos.touched)),r(),d("ngIf",(i.duracionTurnos==null?null:i.duracionTurnos.hasError("max"))&&(i.duracionTurnos==null?null:i.duracionTurnos.touched)),r(),d("disabled",i.form.invalid)}}var T=class t{constructor(o,e){this.alert=o;this.firestore=e}usuarioLogueadoEntidad;fechaSeleccionada="";form;isLoading=!1;horas=[];ngOnInit(){this.form=new ti({duracionTurnos:new v(30,[h.required,h.min(30),h.max(60)]),horaInicio:new v("",h.required),horaFin:new v("",h.required),especialidad:new v("",h.required)},{validators:this.horasValidator()})}handleDateSelected(o){console.log("Recibi el dia:"+o),this.fechaSeleccionada=o,this.ajustarHorariosPorDia()}ajustarHorariosPorDia(){let o=this.convertirFecha(this.fechaSeleccionada);if(!o)return;let e=o.getDay();this.generarHoras(e),e===0?(this.form.get("horaInicio")?.disable(),this.form.get("horaFin")?.disable()):(this.form.get("horaInicio")?.enable(),this.form.get("horaFin")?.enable())}generarHoras(o){console.log("Esta generando las horas"),this.horas=[];let e,i;o===6?(e="08:00",i="14:00"):(e="08:00",i="19:00");for(let s=parseInt(e.split(":")[0]);s<=parseInt(i.split(":")[0]);s++)for(let c=0;c<60;c+=10){let E=`${s.toString().padStart(2,"0")}:${c.toString().padStart(2,"0")}`;if(s===parseInt(i.split(":")[0])&&c>parseInt(i.split(":")[1]))break;(s>parseInt(e.split(":")[0])||s===parseInt(e.split(":")[0])&&c>=parseInt(e.split(":")[1]))&&this.horas.push(E)}}convertirFecha(o){let e=o.split("-");if(e.length!==3)return null;let[i,s,c]=e.map(Number);return new Date(c,s-1,i)}horasValidator(){return o=>{let e=o.get("horaInicio")?.value,i=o.get("horaFin")?.value;return e&&i&&i<=e?{finMenorQueInicio:!0}:null}}onSubmit(){return g(this,null,function*(){if(console.log("se entro al on submit"),this.form.valid){this.isLoading=!0;try{yield this.registrarRespuesta()}catch{this.alert.mostrarError("Error inesperado")}finally{this.isLoading=!1}}else this.alert.mostrarError("El formulario es inv\xE1lido")})}registrarRespuesta(){return g(this,null,function*(){if(!this.usuarioLogueadoEntidad||!this.fechaSeleccionada){this.alert.mostrarError("Faltan datos necesarios para registrar la disponibilidad.");return}let o=this.usuarioLogueadoEntidad.email,e=this.form.get("especialidad")?.value,i=this.fechaSeleccionada.replace(/\//g,"-"),s=this.form.get("horaInicio")?.value,c=this.form.get("horaFin")?.value,E=this.form.get("duracionTurnos")?.value;try{let _=Y(this.firestore,`disponibilidades/${o}`),q=yield B(_);if(q.exists()){let S=q.data();for(let _i in S){let $=S[_i]?.[i];if($){let{horaInicio:Ci,horaFin:vi}=$;if(this.checkSolapamiento(Ci,vi,s,c)){this.alert.mostrarError("Ya existe una disponibilidad en el mismo horario en otra especialidad. Por favor, elige otro horario.");return}}}let xi={[`${e}.${i}`]:{horaInicio:s,horaFin:c,duracionTurnos:E}};yield X(_,xi),this.alert.mostrarSuccess("Disponibilidad guardada o actualizada correctamente.")}else{let S={[e]:{[i]:{horaInicio:s,horaFin:c,duracionTurnos:E}}};yield W(_,S),this.alert.mostrarSuccess("Disponibilidad guardada correctamente.")}}catch(_){console.error("Error al guardar la disponibilidad:",_),this.alert.mostrarError("Hubo un problema al guardar la disponibilidad.")}})}checkSolapamiento(o,e,i,s){return i>=o&&i<e||s>o&&s<=e||i<=o&&s>=e}get duracionTurnos(){return this.form.get("duracionTurnos")}get horaInicio(){return this.form.get("horaInicio")}get horaFin(){return this.form.get("horaFin")}get especialidad(){return this.form.get("especialidad")}static \u0275fac=function(e){return new(e||t)(b(gi),b(D))};static \u0275cmp=P({type:t,selectors:[["app-disponibilidad"]],inputs:{usuarioLogueadoEntidad:"usuarioLogueadoEntidad"},decls:6,vars:3,consts:[[3,"isLoading"],[3,"dateSelected"],[3,"ngSubmit","formGroup"],[1,"seleccion-especialidad",2,"margin-top","20px"],["for","especialidad"],["formControlName","especialidad"],["value","","disabled","","selected",""],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"duracion-turnos"],["type","number","formControlName","duracionTurnos","min","30","max","60","step","1"],["type","submit",3,"disabled"],[3,"value"],[1,"error"],[1,"disponibilidad"],[1,"horarios"],["formControlName","horaInicio",2,"margin-right","20px"],["formControlName","horaFin"]],template:function(e,i){e&1&&(u(0,"app-loading",0),a(1,"h3"),l(2,"Disponibilidad Horaria"),n(),a(3,"app-calendario",1),j("dateSelected",function(c){return i.handleDateSelected(c)}),n(),a(4,"form",2),j("ngSubmit",function(){return i.onSubmit()}),p(5,Ai,18,7),n()),e&2&&(d("isLoading",i.isLoading),r(4),d("formGroup",i.form),r(),M(i.fechaSeleccionada?5:-1))},dependencies:[U,L,x,ni,si,ci,ii,ai,di,ei,oi,ui,pi,ri,li,F],styles:["h3[_ngcontent-%COMP%]{text-align:center;margin-bottom:20px}.disponibilidad[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:left;flex-direction:column;gap:10px;margin-top:10px;background-color:#333;padding:15px;border-radius:10px;box-shadow:0 4px 8px #0003;margin-bottom:20px}.horarios[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin-right:15px}.disponibilidad[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{color:#ddd;font-weight:700;margin-right:5px}.disponibilidad[_ngcontent-%COMP%]   select[_ngcontent-%COMP%], .disponibilidad[_ngcontent-%COMP%]   input[type=time][_ngcontent-%COMP%]{background-color:#444;border:1px solid #555;color:#fff;border-radius:5px;padding:5px;font-size:1rem;width:100px;text-align:center}button[_ngcontent-%COMP%]{background-color:#de1414;color:#fff;border:none;padding:8px 12px;border-radius:5px;cursor:pointer;transition:background-color .3s ease}button[_ngcontent-%COMP%]:hover{background-color:#9b0e0e}button[_ngcontent-%COMP%]:active{background-color:#de1414}button[_ngcontent-%COMP%]:disabled{background-color:#888;cursor:not-allowed}.seleccion-especialidad[_ngcontent-%COMP%]{display:flex;flex-direction:column}select[_ngcontent-%COMP%]{background-color:#333;border:2px solid #f00;color:#fff;padding:10px;width:80%;max-width:500px;margin-bottom:10px;border-radius:5px;transition:border .3s ease;box-shadow:0 2px 5px #0000004d}select[_ngcontent-%COMP%]:focus{border:2px solid #fff;outline:none}input[_ngcontent-%COMP%]{background-color:#333;border:2px solid #f00;color:#fff;padding:10px;width:20%;max-width:500px;margin-bottom:10px;border-radius:5px;transition:border .3s ease;box-shadow:0 2px 5px #0000004d}input[_ngcontent-%COMP%]:focus{border:2px solid #fff;outline:none}select[_ngcontent-%COMP%]   option[_ngcontent-%COMP%]{background-color:#333;color:#fff}.error[_ngcontent-%COMP%]{color:#f33;font-size:1em;margin-top:5px}button[type=submit][_ngcontent-%COMP%]{margin-top:10px;background-color:red;border:none;color:#fff;padding:10px 20px;cursor:pointer;font-size:1em;border-radius:5px;margin-bottom:20px}button[type=submit][_ngcontent-%COMP%]:hover{background-color:#c00;box-shadow:0 2px 5px #0003}button[type=submit][_ngcontent-%COMP%]:disabled{background-color:#666;cursor:not-allowed}.duracion-turnos[_ngcontent-%COMP%]{display:flex;flex-direction:column}"]})};function Hi(t,o){if(t&1&&(k(0),a(1,"p")(2,"strong"),l(3,"Obra Social:"),n(),l(4),n(),a(5,"p")(6,"strong"),l(7,"Imagen Secundaria:"),n()(),u(8,"img",9),H()),t&2){let e=f();r(4),m(" ",e.usuarioLogueadoEntidad.obraSocial,""),r(4),d("src",e.usuarioLogueadoEntidad.imagen2,A)}}function ji(t,o){t&1&&(k(0),a(1,"p")(2,"strong"),l(3,"Rol Administrativo:"),n(),l(4," Admin"),n(),H())}function Ri(t,o){if(t&1&&(a(0,"div",10),u(1,"app-disponibilidad",11),n()),t&2){let e=f();r(),d("usuarioLogueadoEntidad",e.usuarioLogueadoEntidad)}}function Vi(t,o){t&1&&u(0,"app-historia-clinica")}var w=class t{constructor(o,e){this.authService=o;this.firestore=e}usuarioLogueadoEntidad=null;emailUsuarioLogueado=null;isLoading=!1;tieneHistoriaClinica=!1;esPaciente=!1;ngOnInit(){return g(this,null,function*(){this.authService.usuarioLogueado$.subscribe(o=>g(this,null,function*(){this.emailUsuarioLogueado=o,this.emailUsuarioLogueado&&(console.log("Entro a buscar la entidad"),this.usuarioLogueadoEntidad=yield this.authService.getUserEntity(this.emailUsuarioLogueado)),this.usuarioLogueadoEntidad?.rol=="Paciente"&&(console.log("Es paciente"),this.verificarHistoriaClinica())}))})}verificarHistoriaClinica(){return g(this,null,function*(){if(console.log("Verificando historia cl\xEDnica..."),this.usuarioLogueadoEntidad?.rol==="Paciente"){console.log("Usuario logueado es un paciente:",this.usuarioLogueadoEntidad.email);try{let o=Q(this.firestore,"historiasClinicas"),e=K(o,Z("pacienteEmail","==",this.usuarioLogueadoEntidad.email));console.log("Consulta creada:",e);let i=yield J(e);console.log("Consulta ejecutada. Resultados:",i.docs.length),i.empty?(this.tieneHistoriaClinica=!1,console.log("No se encontr\xF3 ninguna historia cl\xEDnica para el paciente.")):(this.tieneHistoriaClinica=!0,console.log("Historia cl\xEDnica encontrada."))}catch(o){console.error("Error al verificar la historia cl\xEDnica:",o)}}else console.log("El usuario no es un paciente, rol actual:",this.usuarioLogueadoEntidad?.rol)})}getImagenPerfil(){return this.usuarioLogueadoEntidad?.imagen1||""}isMedico(o){return o&&o.especialidades!==void 0}isPaciente(o){return o&&o.obraSocial!==void 0}isAdmin(o){return o&&o.rol==="Admin"}static \u0275fac=function(e){return new(e||t)(b(hi),b(D))};static \u0275cmp=P({type:t,selectors:[["app-perfil"]],decls:29,vars:12,consts:[[3,"isLoading"],[1,"banner"],[1,"perfil-container"],[1,"perfil-column","perfil-info"],[1,"perfil-header"],["alt","Imagen de Perfil",1,"perfil-imagen",3,"src"],[1,"perfil-rol"],[4,"ngIf"],["class","perfil-column disponibilidad-container",4,"ngIf"],["alt","Imagen 2",1,"perfil-imagen-secundaria",3,"src"],[1,"perfil-column","disponibilidad-container"],[3,"usuarioLogueadoEntidad"]],template:function(e,i){e&1&&(u(0,"app-loading",0),a(1,"section")(2,"div",1)(3,"h2"),l(4,"MI PERFIL"),n()()(),a(5,"div",2)(6,"div",3)(7,"div",4),u(8,"img",5),a(9,"h2"),l(10),n(),a(11,"span",6),l(12),n()(),a(13,"p")(14,"strong"),l(15,"Email:"),n(),l(16),n(),a(17,"p")(18,"strong"),l(19,"Documento:"),n(),l(20),n(),a(21,"p")(22,"strong"),l(23,"Edad:"),n(),l(24),n(),p(25,Hi,9,2,"ng-container",7)(26,ji,5,0,"ng-container",7),n(),p(27,Ri,2,1,"div",8),n(),p(28,Vi,1,0,"app-historia-clinica")),e&2&&(d("isLoading",i.isLoading),r(8),d("src",i.getImagenPerfil(),A),r(2),z("",i.usuarioLogueadoEntidad==null?null:i.usuarioLogueadoEntidad.nombre," ",i.usuarioLogueadoEntidad==null?null:i.usuarioLogueadoEntidad.apellido,""),r(2),C(i.usuarioLogueadoEntidad==null?null:i.usuarioLogueadoEntidad.rol),r(4),m(" ",i.usuarioLogueadoEntidad==null?null:i.usuarioLogueadoEntidad.email,""),r(4),m(" ",i.usuarioLogueadoEntidad==null?null:i.usuarioLogueadoEntidad.documento,""),r(4),m(" ",i.usuarioLogueadoEntidad==null?null:i.usuarioLogueadoEntidad.edad," a\xF1os"),r(),d("ngIf",i.isPaciente(i.usuarioLogueadoEntidad)),r(),d("ngIf",i.isAdmin(i.usuarioLogueadoEntidad)),r(),d("ngIf",i.isMedico(i.usuarioLogueadoEntidad)),r(),M(i.tieneHistoriaClinica?28:-1))},dependencies:[L,x,O,T],styles:[".perfil-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:20px;margin:50px auto;padding:30px;max-width:1200px;background-color:#2c2c2c;border-radius:15px;box-shadow:0 8px 16px #0000004d;color:#fff;font-family:Arial,sans-serif}.perfil-column[_ngcontent-%COMP%]{flex:1}.perfil-header[_ngcontent-%COMP%]{text-align:center;margin-bottom:20px}.perfil-imagen[_ngcontent-%COMP%]{width:150px;height:150px;border-radius:50%;object-fit:cover;margin-bottom:10px;border:2px solid #fff}.perfil-rol[_ngcontent-%COMP%]{display:inline-block;margin-top:5px;padding:5px 10px;background-color:#612109;color:#fff;border-radius:5px;font-size:.9rem}.perfil-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:10px 0;font-size:1rem}.perfil-imagen-secundaria[_ngcontent-%COMP%]{width:100%;max-width:300px;height:auto;margin-top:10px;border-radius:10px;border:1px solid #fff}"]})};var qi=[{path:"",component:w}],N=class t{static \u0275fac=function(e){return new(e||t)};static \u0275mod=I({type:t});static \u0275inj=y({imports:[R.forChild(qi),R]})};var bi=class t{static \u0275fac=function(e){return new(e||t)};static \u0275mod=I({type:t});static \u0275inj=y({imports:[G,N,x,mi,fi,F,O]})};export{bi as PerfilModule};
