import{a as ii}from"./chunk-NXW457HU.js";import{A as g,D as a,E as t,F,I as P,J as D,Ja as A,K as u,Ka as k,L as O,N as s,Oa as S,P as h,Pa as B,Qa as w,R as _,S as x,T as v,Ta as E,U as I,Ua as R,Va as y,Xa as j,Y as L,Z as V,Za as z,_a as G,ab as U,cb as J,da as T,db as K,ea as W,eb as Q,fa as N,ga as q,j as H,mb as X,n as p,o as m,pb as Y,rb as Z,sb as $,v as l,w as M,y as b}from"./chunk-LOSKLSOT.js";import{g as f}from"./chunk-RA2WU32H.js";function ni(c,o){if(c&1){let i=P();a(0,"div",13)(1,"label",14),s(2),t(),a(3,"input",15),v("ngModelChange",function(e){let n=p(i).$implicit;return x(n.clave,e)||(n.clave=e),m(e)}),t(),a(4,"input",16),v("ngModelChange",function(e){let n=p(i).$implicit;return x(n.valor,e)||(n.valor=e),m(e)}),t()()}if(c&2){let i=o.$implicit,r=o.index;l(2),h("Nuevo dato ",r+1,""),l(),O("name","clave",r,""),_("ngModel",i.clave),l(),O("name","valor",r,""),_("ngModel",i.valor)}}function ai(c,o){if(c&1){let i=P();a(0,"div")(1,"form",3),D("ngSubmit",function(){p(i);let e=u();return m(e.guardarHistoriaClinica())}),a(2,"div",4)(3,"label"),s(4,"Altura"),t(),a(5,"input",5),v("ngModelChange",function(e){p(i);let n=u();return x(n.historiaClinica.altura,e)||(n.historiaClinica.altura=e),m(e)}),t(),a(6,"label"),s(7,"Peso"),t(),a(8,"input",6),v("ngModelChange",function(e){p(i);let n=u();return x(n.historiaClinica.peso,e)||(n.historiaClinica.peso=e),m(e)}),t(),a(9,"label"),s(10,"Temperatura"),t(),a(11,"input",7),v("ngModelChange",function(e){p(i);let n=u();return x(n.historiaClinica.temperatura,e)||(n.historiaClinica.temperatura=e),m(e)}),t(),a(12,"label"),s(13,"Presi\xF3n"),t(),a(14,"input",8),v("ngModelChange",function(e){p(i);let n=u();return x(n.historiaClinica.presion,e)||(n.historiaClinica.presion=e),m(e)}),t()(),a(15,"div",9),b(16,ni,5,7,"div",10),a(17,"button",11),D("click",function(){p(i);let e=u();return m(e.agregarDatoDinamico())}),s(18,"Agregar dato"),t(),a(19,"button",12),s(20,"Guardar"),t()()()()}if(c&2){let i=u();l(5),_("ngModel",i.historiaClinica.altura),l(3),_("ngModel",i.historiaClinica.peso),l(3),_("ngModel",i.historiaClinica.temperatura),l(3),_("ngModel",i.historiaClinica.presion),l(2),g("ngForOf",i.historiaClinica.datosDinamicos),l(),g("disabled",i.historiaClinica.datosDinamicos.length>=i.maxDatosDinamicos)}}function oi(c,o){if(c&1&&(a(0,"div")(1,"li")(2,"span",20),s(3),t(),s(4),t()()),c&2){let i=o.$implicit;l(3),h("",i.clave,":"),l(),h(" ",i.valor," ")}}function ri(c,o){if(c&1&&(a(0,"div",18)(1,"h3"),s(2),L(3,"date"),t(),a(4,"div",19)(5,"div",4)(6,"ul")(7,"li")(8,"span",20),s(9,"Altura:"),t(),s(10),t(),a(11,"li")(12,"span",20),s(13,"Peso:"),t(),s(14),t(),a(15,"li")(16,"span",20),s(17,"Temperatura:"),t(),s(18),t(),a(19,"li")(20,"span",20),s(21,"Presi\xF3n:"),t(),s(22),t()()(),a(23,"div",9)(24,"ul"),b(25,oi,5,2,"div",21),t()()()()),c&2){let i=o.$implicit;l(2),h("Fecha: ",V(3,6,i.historiaClinica.fechaCreacion.toDate(),"dd/MM/yyyy"),""),l(8),h(" ",i.historiaClinica.altura," "),l(4),h(" ",i.historiaClinica.peso," "),l(4),h(" ",i.historiaClinica.temperatura," "),l(4),h(" ",i.historiaClinica.presion," "),l(3),g("ngForOf",i.historiaClinica.datosDinamicos)}}function li(c,o){if(c&1&&(a(0,"div"),b(1,ri,26,9,"div",17),t()),c&2){let i=u();l(),g("ngForOf",i.historiasClinicasPaciente)}}var ei=class c{constructor(o,i,r){this.auth=o;this.firestore=i;this.alert=r}historiaClinica={altura:null,peso:null,temperatura:null,presion:null,datosDinamicos:[]};maxDatosDinamicos=3;usuarioLogueado=null;isAdmin=!1;isMedico=!1;isPaciente=!1;pacienteEmail=null;fechaSolicitud=null;editable=null;isLoading=!1;historiasClinicasPaciente=[];ngOnInit(){return f(this,null,function*(){this.auth.usuarioLogueado$.subscribe(o=>{this.usuarioLogueado=o}),this.auth.pacienteHistoriaClinicaEditable$.subscribe(o=>{this.editable=o}),this.auth.pacienteHistoriaClinicaEmail$.subscribe(o=>f(this,null,function*(){this.pacienteEmail=o})),this.editable?(this.auth.pacienteHistoriaClinicaFechaSolicitud$.subscribe(o=>f(this,null,function*(){this.fechaSolicitud=o})),this.pacienteEmail&&this.fechaSolicitud?yield this.cargarHistoriaClinicaEditable(this.pacienteEmail,this.fechaSolicitud):console.log("El email del paciente es null, undefined o inv\xE1lido.")):yield this.cargarHistoriaClinicaLectura(this.pacienteEmail)})}cargarHistoriaClinicaLectura(o){return f(this,null,function*(){try{this.isLoading=!0;let i=S(this.firestore,"turnos"),r=E(i,y("paciente","==",o)),e=yield w(r);this.historiasClinicasPaciente=[],e.forEach(n=>{let C=n.data(),d=C.historiaClinica;if(d){let ti={altura:d.altura||null,peso:d.peso||null,temperatura:d.temperatura||null,presion:d.presion||null,datosDinamicos:d.datosDinamicos||[],fechaCreacion:d.fechaCreacion};this.historiasClinicasPaciente.push({fechaCreacion:C.fechaCreacion,historiaClinica:ti})}}),this.historiasClinicasPaciente.sort((n,C)=>C.fechaCreacion.seconds-n.fechaCreacion.seconds)}catch(i){console.error("Error al cargar las historias cl\xEDnicas:",i)}finally{this.isLoading=!1}})}cargarHistoriaClinicaEditable(o,i){return f(this,null,function*(){try{this.isLoading=!0;let r=S(this.firestore,"turnos"),e=E(r,y("paciente","==",o),y("fechaSolicitud","==",i)),n=yield w(e);if(n.empty)console.log("No se encontr\xF3 un turno para este paciente en esta fecha.");else{let d=n.docs[0].data().historiaClinica;d?this.historiaClinica={altura:d.altura||null,peso:d.peso||null,temperatura:d.temperatura||null,presion:d.presion||null,datosDinamicos:d.datosDinamicos||[]}:console.log("No se encontr\xF3 historia cl\xEDnica para este paciente.")}}catch(r){console.error("Error al obtener la historia cl\xEDnica:",r)}finally{this.isLoading=!1}})}agregarDatoDinamico(){this.historiaClinica.datosDinamicos.length<this.maxDatosDinamicos&&this.historiaClinica.datosDinamicos.push({clave:"",valor:""})}guardarHistoriaClinica(){return f(this,null,function*(){if(this.pacienteEmail&&this.fechaSolicitud)if(this.validarHistoriaClinica()){let o={altura:this.historiaClinica.altura,peso:this.historiaClinica.peso,temperatura:this.historiaClinica.temperatura,presion:this.historiaClinica.presion,datosDinamicos:this.historiaClinica.datosDinamicos,fechaCreacion:A.now()};try{this.isLoading=!0;let i=S(this.firestore,"turnos"),r=E(i,y("paciente","==",this.pacienteEmail),y("fechaSolicitud","==",this.fechaSolicitud)),e=yield w(r);if(e.empty)this.alert.mostrarError("No se encontr\xF3 el turno para este paciente en esta fecha");else{let n=e.docs[0],C=B(this.firestore,`turnos/${n.id}`);yield R(C,{historiaClinica:o}),this.alert.mostrarSuccess("Historia cl\xEDnica guardada con \xE9xito")}}catch(i){this.alert.mostrarError("Error al guardar la historia cl\xEDnica"),console.error("Error:",i)}finally{this.isLoading=!1}}else this.alert.mostrarError("Por favor complete todos los campos obligatorios");else console.log("No se puede guardar la historia cl\xEDnica, el email del paciente o la fecha son inv\xE1lidos.")})}validarHistoriaClinica(){return!!(this.historiaClinica.altura&&this.historiaClinica.peso&&this.historiaClinica.temperatura&&this.historiaClinica.presion)}static \u0275fac=function(i){return new(i||c)(M(ii),M(k),M($))};static \u0275cmp=H({type:c,selectors:[["app-historia-clinica"]],standalone:!0,features:[I],decls:8,vars:3,consts:[[3,"isLoading"],[1,"banner"],[4,"ngIf"],[1,"historia-clinica",3,"ngSubmit"],[1,"izq"],["type","number","name","altura","placeholder","Altura","required","",3,"ngModelChange","ngModel"],["type","number","name","peso","placeholder","Peso","required","",3,"ngModelChange","ngModel"],["type","number","name","temperatura","placeholder","Temperatura","required","",3,"ngModelChange","ngModel"],["type","text","name","presion","placeholder","Presi\xF3n","required","",3,"ngModelChange","ngModel"],[1,"der"],["class","par",4,"ngFor","ngForOf"],["type","button",3,"click","disabled"],["type","submit"],[1,"par"],["for","nuevo"],["type","text","placeholder","Clave","required","",3,"ngModelChange","name","ngModel"],["type","text","placeholder","Valor","required","",3,"ngModelChange","name","ngModel"],["class","historia-clinica-lectura",4,"ngFor","ngForOf"],[1,"historia-clinica-lectura"],[1,"hc-individual"],[1,"label"],[4,"ngFor","ngForOf"]],template:function(i,r){i&1&&(F(0,"app-loading",0),a(1,"section")(2,"div",1)(3,"h2"),s(4,"HISTORIA CLINICA"),t()()(),a(5,"section"),b(6,ai,21,6,"div",2)(7,li,2,1,"div",2),t()),i&2&&(g("isLoading",r.isLoading),l(6),g("ngIf",r.editable),l(),g("ngIf",!r.editable))},dependencies:[q,T,W,N,Y,K,j,Q,z,G,X,J,U,Z],styles:[".historia-clinica[_ngcontent-%COMP%]{display:flex;flex-direction:row;margin:50px 100px;justify-content:center}.historia-clinica-lectura[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin:50px 100px;justify-content:center}.hc-individual[_ngcontent-%COMP%]{display:flex;flex-direction:row}.izq[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin-right:150px}.der[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin-left:150px}.dinamicos[_ngcontent-%COMP%], .boton[_ngcontent-%COMP%]{display:flex}label[_ngcontent-%COMP%]{color:#fff;font-family:Ubuntu;margin-bottom:5px}input[_ngcontent-%COMP%]{background-color:#333;border:2px solid #f00;color:#fff;padding:10px;width:100%;max-width:500px;border-radius:5px;transition:border .3s ease,box-shadow .3s ease;box-shadow:0 2px 5px #0000004d;margin-bottom:5px}.par[_ngcontent-%COMP%]{margin-bottom:10px}input[_ngcontent-%COMP%]:focus{border:2px solid #fff;outline:none;box-shadow:0 0 10px #ffffff80}button[_ngcontent-%COMP%]{margin-top:10px;background-color:red;border:none;color:#fff;padding:10px 20px;cursor:pointer;font-size:1em;border-radius:5px;transition:background-color .3s,box-shadow .3s;margin-bottom:20px}button[_ngcontent-%COMP%]:hover{background-color:#c00;box-shadow:0 4px 10px #0003}button[_ngcontent-%COMP%]:disabled{background-color:#666;cursor:not-allowed}.error[_ngcontent-%COMP%]{color:#f33;font-size:.9em;margin-top:5px}.label[_ngcontent-%COMP%]{font-family:ubuntu;color:red}.historia-clinica[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style-type:none;padding:0;margin:0}.historia-clinica[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:10px;color:#fff}.hc-individual[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style-type:none;padding:0;margin:0}.hc-individual[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:10px;color:#fff}.historia-clinica-lectura[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-top:20px;margin-bottom:20px;color:#fff}"]})};export{ei as a};
