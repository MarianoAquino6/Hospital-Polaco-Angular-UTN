import{a as Y}from"./chunk-EPQ6NRZE.js";import{$a as G,B as g,E as a,Ea as F,F as n,G as O,Ha as T,Ia as y,J as b,Ja as N,K as M,L as m,La as S,M as w,O as s,Oa as E,Q as u,Qa as q,Ra as P,S as h,Sa as k,T as C,U as f,Ua as R,V,Va as B,Xa as z,Za as j,_a as U,a as D,b as H,ba as I,c as _,ca as A,da as W,hb as J,jb as K,l as L,lb as Q,mb as X,q as d,r as p,x as l,y as x,z as v}from"./chunk-XMWGSLYE.js";function $(c,o){if(c&1){let i=b();a(0,"div",13)(1,"label",14),s(2),n(),a(3,"input",15),f("ngModelChange",function(e){let t=d(i).$implicit;return C(t.clave,e)||(t.clave=e),p(e)}),n(),a(4,"input",16),f("ngModelChange",function(e){let t=d(i).$implicit;return C(t.valor,e)||(t.valor=e),p(e)}),n()()}if(c&2){let i=o.$implicit,r=o.index;l(2),u("Nuevo dato ",r+1,""),l(),w("name","clave",r,""),h("ngModel",i.clave),l(),w("name","valor",r,""),h("ngModel",i.valor)}}function ii(c,o){if(c&1){let i=b();a(0,"div")(1,"form",3),M("ngSubmit",function(){d(i);let e=m();return p(e.guardarHistoriaClinica())}),a(2,"div",4)(3,"label"),s(4,"Altura"),n(),a(5,"input",5),f("ngModelChange",function(e){d(i);let t=m();return C(t.historiaClinica.altura,e)||(t.historiaClinica.altura=e),p(e)}),n(),a(6,"label"),s(7,"Peso"),n(),a(8,"input",6),f("ngModelChange",function(e){d(i);let t=m();return C(t.historiaClinica.peso,e)||(t.historiaClinica.peso=e),p(e)}),n(),a(9,"label"),s(10,"Temperatura"),n(),a(11,"input",7),f("ngModelChange",function(e){d(i);let t=m();return C(t.historiaClinica.temperatura,e)||(t.historiaClinica.temperatura=e),p(e)}),n(),a(12,"label"),s(13,"Presi\xF3n"),n(),a(14,"input",8),f("ngModelChange",function(e){d(i);let t=m();return C(t.historiaClinica.presion,e)||(t.historiaClinica.presion=e),p(e)}),n()(),a(15,"div",9),v(16,$,5,7,"div",10),a(17,"button",11),M("click",function(){d(i);let e=m();return p(e.agregarDatoDinamico())}),s(18,"Agregar dato"),n(),a(19,"button",12),s(20,"Guardar"),n()()()()}if(c&2){let i=m();l(5),h("ngModel",i.historiaClinica.altura),l(3),h("ngModel",i.historiaClinica.peso),l(3),h("ngModel",i.historiaClinica.temperatura),l(3),h("ngModel",i.historiaClinica.presion),l(2),g("ngForOf",i.historiaClinica.datosDinamicos),l(),g("disabled",i.historiaClinica.datosDinamicos.length>=i.maxDatosDinamicos)}}function ei(c,o){if(c&1&&(a(0,"div")(1,"li")(2,"span",18),s(3),n(),s(4),n()()),c&2){let i=o.$implicit;l(3),u("",i.clave,":"),l(),u(" ",i.valor," ")}}function ti(c,o){if(c&1&&(a(0,"div")(1,"div",17)(2,"div",4)(3,"ul")(4,"li")(5,"span",18),s(6,"Altura:"),n(),s(7),n(),a(8,"li")(9,"span",18),s(10,"Peso:"),n(),s(11),n(),a(12,"li")(13,"span",18),s(14,"Temperatura:"),n(),s(15),n(),a(16,"li")(17,"span",18),s(18,"Presi\xF3n:"),n(),s(19),n()()(),a(20,"div",9)(21,"ul"),v(22,ei,5,2,"div",19),n()()()()),c&2){let i=m();l(7),u(" ",i.historiaClinica.altura," "),l(4),u(" ",i.historiaClinica.peso," "),l(4),u(" ",i.historiaClinica.temperatura," "),l(4),u(" ",i.historiaClinica.presion," "),l(3),g("ngForOf",i.historiaClinica.datosDinamicos)}}var Z=class c{constructor(o,i,r){this.auth=o;this.firestore=i;this.alert=r}historiaClinica={altura:null,peso:null,temperatura:null,presion:null,datosDinamicos:[]};maxDatosDinamicos=3;usuarioLogueado=null;isAdmin=!1;isMedico=!1;isPaciente=!1;pacienteEmail=null;isLoading=!1;ngOnInit(){return _(this,null,function*(){if(this.auth.usuarioLogueado$.subscribe(o=>{this.usuarioLogueado=o,console.log("Usuario logueado:",this.usuarioLogueado)}),this.usuarioLogueado){let o=yield this.auth.getUserRole(this.usuarioLogueado);this.isAdmin=o==="Admin",this.isMedico=o==="Medico",this.isPaciente=o==="Paciente"}this.isPaciente?(this.auth.setPacienteHistoriaClinica(this.usuarioLogueado),this.usuarioLogueado&&(yield this.cargarHistoriaClinica(this.usuarioLogueado))):this.auth.pacienteHistoriaClinicaEmail$.subscribe(o=>_(this,null,function*(){this.pacienteEmail=o,console.log("Paciente HC:",this.pacienteEmail),this.pacienteEmail?yield this.cargarHistoriaClinica(this.pacienteEmail):console.log("El email del paciente es null, undefined o inv\xE1lido.")}))})}cargarHistoriaClinica(o){return _(this,null,function*(){try{this.isLoading=!0;let i=y(this.firestore,"historiasClinicas"),r=E(i,P("pacienteEmail","==",o)),e=yield S(r);if(e.empty)console.log("No se encontr\xF3 una historia cl\xEDnica para este paciente.");else{let t=e.docs[0].data();this.historiaClinica={altura:t.altura||null,peso:t.peso||null,temperatura:t.temperatura||null,presion:t.presion||null,datosDinamicos:t.datosDinamicos||[]}}}catch(i){console.error("Error al obtener la historia cl\xEDnica:",i)}finally{this.isLoading=!1}})}agregarDatoDinamico(){this.historiaClinica.datosDinamicos.length<this.maxDatosDinamicos&&this.historiaClinica.datosDinamicos.push({clave:"",valor:""})}guardarHistoriaClinica(){return _(this,null,function*(){if(this.isMedico&&this.pacienteEmail)if(this.validarHistoriaClinica()){let o=H(D({pacienteEmail:this.pacienteEmail},this.historiaClinica),{fechaModificacion:new Date});try{this.isLoading=!0;let i=y(this.firestore,"historiasClinicas"),r=E(i,P("pacienteEmail","==",this.pacienteEmail)),e=yield S(r);if(e.empty){let t=y(this.firestore,"historiasClinicas");yield T(t,o),this.alert.mostrarSuccess("Historia cl\xEDnica guardada con \xE9xito")}else{let t=N(this.firestore,"historiasClinicas",e.docs[0].id);yield q(t,o),this.alert.mostrarSuccess("Historia cl\xEDnica actualizada con \xE9xito")}}catch(i){this.alert.mostrarError("Error al guardar la historia cl\xEDnica"),console.error("Error:",i)}finally{this.isLoading=!1}}else this.alert.mostrarError("Por favor complete todos los campos obligatorios");else console.log("No se puede guardar la historia cl\xEDnica, el email del paciente es inv\xE1lido.")})}validarHistoriaClinica(){return!!(this.historiaClinica.altura&&this.historiaClinica.peso&&this.historiaClinica.temperatura&&this.historiaClinica.presion)}static \u0275fac=function(i){return new(i||c)(x(Y),x(F),x(X))};static \u0275cmp=L({type:c,selectors:[["app-historia-clinica"]],standalone:!0,features:[V],decls:8,vars:3,consts:[[3,"isLoading"],[1,"banner"],[4,"ngIf"],[1,"historia-clinica",3,"ngSubmit"],[1,"izq"],["type","number","name","altura","placeholder","Altura","required","",3,"ngModelChange","ngModel"],["type","number","name","peso","placeholder","Peso","required","",3,"ngModelChange","ngModel"],["type","number","name","temperatura","placeholder","Temperatura","required","",3,"ngModelChange","ngModel"],["type","text","name","presion","placeholder","Presi\xF3n","required","",3,"ngModelChange","ngModel"],[1,"der"],["class","par",4,"ngFor","ngForOf"],["type","button",3,"click","disabled"],["type","submit"],[1,"par"],["for","nuevo"],["type","text","placeholder","Clave","required","",3,"ngModelChange","name","ngModel"],["type","text","placeholder","Valor","required","",3,"ngModelChange","name","ngModel"],[1,"historia-clinica"],[1,"label"],[4,"ngFor","ngForOf"]],template:function(i,r){i&1&&(O(0,"app-loading",0),a(1,"section")(2,"div",1)(3,"h2"),s(4,"HISTORIA CLINICA"),n()()(),a(5,"section"),v(6,ii,21,6,"div",2)(7,ti,23,5,"div",2),n()),i&2&&(g("isLoading",r.isLoading),l(6),g("ngIf",r.isMedico),l(),g("ngIf",r.isPaciente||r.isAdmin))},dependencies:[W,I,A,K,U,k,G,R,B,J,j,z,Q],styles:[".historia-clinica[_ngcontent-%COMP%]{display:flex;flex-direction:row;margin:50px 100px;justify-content:center}.izq[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin-right:150px}.der[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin-left:150px}.dinamicos[_ngcontent-%COMP%], .boton[_ngcontent-%COMP%]{display:flex}label[_ngcontent-%COMP%]{color:#fff;font-family:Ubuntu;margin-bottom:5px}input[_ngcontent-%COMP%]{background-color:#333;border:2px solid #f00;color:#fff;padding:10px;width:100%;max-width:500px;border-radius:5px;transition:border .3s ease,box-shadow .3s ease;box-shadow:0 2px 5px #0000004d;margin-bottom:5px}.par[_ngcontent-%COMP%]{margin-bottom:10px}input[_ngcontent-%COMP%]:focus{border:2px solid #fff;outline:none;box-shadow:0 0 10px #ffffff80}button[_ngcontent-%COMP%]{margin-top:10px;background-color:red;border:none;color:#fff;padding:10px 20px;cursor:pointer;font-size:1em;border-radius:5px;transition:background-color .3s,box-shadow .3s;margin-bottom:20px;/}button[_ngcontent-%COMP%]:hover{background-color:#c00;box-shadow:0 4px 10px #0003}button[_ngcontent-%COMP%]:disabled{background-color:#666;cursor:not-allowed}.error[_ngcontent-%COMP%]{color:#f33;font-size:.9em;margin-top:5px}.label[_ngcontent-%COMP%]{font-family:ubuntu;color:red}.historia-clinica[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style-type:none;padding:0;margin:0}.historia-clinica[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:10px;color:#fff}"]})};export{Z as a};
