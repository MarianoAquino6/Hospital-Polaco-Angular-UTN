import{c as q,d as M,f as x,g as U,h as E}from"./chunk-XAZLOLJU.js";import{a as ae}from"./chunk-DSUBOXN5.js";import{a as oe}from"./chunk-NXW457HU.js";import{A as r,B as G,D as a,E as o,F as w,I as S,J as b,K as p,Ka as ee,N as l,Na as ie,O as T,Oa as D,P as L,Q as J,Qa as k,Ta as F,Va as A,W as B,ca as K,da as Q,ea as W,f as O,ga as Y,j as X,k as I,ma as Z,n as _,o as h,pa as H,qb as te,rb as V,sb as ne,u as j,v as c,w as P,y as g}from"./chunk-LOSKLSOT.js";import{a as z,g as f}from"./chunk-RA2WU32H.js";var me=t=>({"horario-seleccionado":t});function ue(t,i){if(t&1){let e=S();a(0,"tr",12),b("click",function(){let s=_(e).$implicit,d=p(3);return h(d.seleccionarPaciente(s))}),a(1,"td"),l(2),o(),a(3,"td"),l(4),o(),a(5,"td"),l(6),o()()}if(t&2){let e=i.$implicit;c(2),T(e.nombre),c(2),T(e.email),c(2),T(e.documento)}}function ge(t,i){if(t&1&&(a(0,"table")(1,"tr")(2,"th"),l(3,"Nombre"),o(),a(4,"th"),l(5,"Email"),o(),a(6,"th"),l(7,"Documento"),o()(),g(8,ue,7,3,"tr",11),o()),t&2){let e=p(2);c(8),r("ngForOf",e.pacientesDisponibles)}}function fe(t,i){t&1&&(a(0,"p"),l(1,"No hay pacientes disponibles."),o())}function _e(t,i){if(t&1&&(a(0,"section",8)(1,"h3"),l(2,"Seleccione un paciente:"),o(),a(3,"div",9),g(4,ge,9,1,"table",10)(5,fe,2,0,"p",10),o()()),t&2){let e=p();r("@fadeInOut",void 0),c(4),r("ngIf",e.pacientesDisponibles.length>0),c(),r("ngIf",e.pacientesDisponibles.length===0)}}function he(t,i){if(t&1){let e=S();a(0,"div",16),b("click",function(){let s=_(e).$implicit,d=p(2);return h(d.seleccionarMedico(s))}),a(1,"h4"),l(2),o(),w(3,"img",17),o()}if(t&2){let e=i.$implicit;c(2),J("",e.nombre," ",e.apellido,""),c(),r("src",e.imagen1,j)}}function Se(t,i){if(t&1&&(a(0,"section",13)(1,"h3"),l(2,"Seleccione un m\xE9dico"),o(),a(3,"div",14),g(4,he,4,3,"div",15),o()()),t&2){let e=p();r("@fadeInOut",void 0),c(4),r("ngForOf",e.medicos)}}function be(t,i){if(t&1){let e=S();a(0,"div",21),b("click",function(){let s=_(e).$implicit,d=p(2);return h(d.seleccionarEspecialidad(s))}),a(1,"h4"),l(2),o(),w(3,"img",22),o()}if(t&2){let e=i.$implicit,n=p(2);G("selected",n.especialidadSeleccionada===e),c(2),T(e),c(),r("src",n.getImagenEspecialidad(e),j)}}function xe(t,i){if(t&1&&(a(0,"section",18)(1,"h3"),l(2,"Especialidades del m\xE9dico"),o(),a(3,"div",19),g(4,be,4,4,"div",20),o()()),t&2){let e=p();r("@fadeInOut",void 0),c(4),r("ngForOf",e.medicoSeleccionado.especialidades)}}function Ce(t,i){if(t&1){let e=S();a(0,"button",12),b("click",function(){let s=_(e).$implicit,d=p(2);return h(d.seleccionarDia(s))}),l(1),o()}if(t&2){let e=i.$implicit;c(),L(" ",e," ")}}function ve(t,i){t&1&&(a(0,"p"),l(1,"No hay d\xEDas disponibles."),o())}function ye(t,i){if(t&1&&(a(0,"section",23)(1,"h3"),l(2,"D\xEDas Disponibles"),o(),a(3,"div",24),g(4,Ce,2,1,"button",11)(5,ve,2,0,"p",10),o()()),t&2){let e=p();r("@slideIn",void 0),c(4),r("ngForOf",e.diasDisponibles),c(),r("ngIf",e.diasDisponibles.length===0)}}function Pe(t,i){if(t&1){let e=S();a(0,"button",29),b("click",function(){let s=_(e).$implicit,d=p(2);return h(d.seleccionarHorario(s))}),l(1),o()}if(t&2){let e=i.$implicit,n=p(2);r("ngClass",B(2,me,e===n.horarioSeleccionado)),c(),L(" ",e," ")}}function Te(t,i){t&1&&(a(0,"p"),l(1,"No hay horarios disponibles."),o())}function De(t,i){if(t&1){let e=S();a(0,"button",30),b("click",function(){_(e);let s=p(2);return h(s.guardarTurno())}),l(1," Guardar Turno "),o()}if(t&2){let e=p(2);r("disabled",!e.horarioSeleccionado)}}function Me(t,i){if(t&1&&(a(0,"section",25)(1,"h3"),l(2,"Horarios Disponibles"),o(),a(3,"div",26),g(4,Pe,2,4,"button",27)(5,Te,2,0,"p",10),o(),g(6,De,2,1,"button",28),o()),t&2){let e=p();r("@slideIn",void 0),c(4),r("ngForOf",e.horariosDisponibles),c(),r("ngIf",e.horariosDisponibles.length===0),c(),r("ngIf",e.horarioSeleccionado)}}var N=class t{constructor(i,e,n,s){this.firestore=i;this.auth=e;this.alert=n;this.router=s}isLoading=!1;medicos=[];medicoSeleccionado=null;diasDisponibles=[];diaSeleccionado=null;horariosDisponibles=[];especialidadSeleccionada=null;horarioSeleccionado=null;emailPaciente=null;isAdmin=!1;pacientesDisponibles;pantallaActual;ngOnInit(){this.cargarMedicos();let i=this.auth.obtenerUsuarioLogueado();i&&this.auth.getUserRole(i).then(e=>{e==="Admin"&&(this.isAdmin=!0,this.pantallaActual="pacientes",this.buscarPacientesDisponibles()),e==="Paciente"&&(this.emailPaciente=i,this.pantallaActual="medicos")})}cambiarPantalla(i){this.pantallaActual=i}buscarPacientesDisponibles(){return f(this,null,function*(){let i=new Set;try{let e=D(this.firestore,"usuarios"),n=F(e,A("rol","==","Paciente"));(yield k(n)).forEach(d=>{let u=d.data(),C={email:u.email,nombre:`${u.nombre} ${u.apellido}`,documento:u.documento};i.add(C)}),this.pacientesDisponibles=Array.from(i)}catch{this.alert.mostrarError("Error al obtener pacientes")}})}seleccionarEspecialidad(i){this.especialidadSeleccionada=i,this.cargarDiasDisponibles(),this.cambiarPantalla("dias")}seleccionarPaciente(i){this.emailPaciente=i.email,this.cambiarPantalla("medicos"),console.log(`Paciente seleccionado: ${i.nombre} ${i.apellido}`)}cargarMedicos(){return f(this,null,function*(){this.isLoading=!0;try{let i=D(this.firestore,"usuarios"),e=F(i,A("rol","==","Medico")),n=yield k(e);this.medicos=n.docs.map(s=>z({id:s.id},s.data()))}catch(i){this.alert.mostrarError("Error al cargar m\xE9dicos:"+i)}finally{this.isLoading=!1}})}seleccionarMedico(i){this.medicoSeleccionado=i,this.cambiarPantalla("especialidades")}getImagenEspecialidad(i){return{Cardiolog\u00EDa:"assets/img/cardiologia.png",Dermatolog\u00EDa:"assets/img/dermatologia.png",Pediatr\u00EDa:"assets/img/pediatria.png",Neurolog\u00EDa:"assets/img/neurologia.png"}[i]||"assets/img/default.png"}cargarDiasDisponibles(){return f(this,null,function*(){let i=this.medicoSeleccionado.disponibilidad||{},e=new Date;e.setHours(0,0,0,0);let n=Array.from({length:15},(u,C)=>{let v=new Date(e);return v.setDate(e.getDate()+C),v.toISOString().split("T")[0]}),s=["Lunes","Martes","Mi\xE9rcoles","Jueves","Viernes","S\xE1bado","Domingo"],d=this.especialidadSeleccionada?i[this.especialidadSeleccionada]:null;if(!d){this.alert.mostrarError("No hay disponibilidad para la especialidad seleccionada."),this.diasDisponibles=[];return}this.diasDisponibles=n.filter(u=>{let v=new Date(u).getDay(),$=s[v];return!!d[$]})})}seleccionarDia(i){return f(this,null,function*(){this.diaSeleccionado=i,this.cargarHorariosDisponibles(),this.cambiarPantalla("horarios")})}cargarHorariosDisponibles(){return f(this,null,function*(){if(!this.diaSeleccionado){this.alert.mostrarError("No se ha seleccionado un d\xEDa.");return}let e=new Date(this.diaSeleccionado).getDay(),s=["Lunes","Martes","Mi\xE9rcoles","Jueves","Viernes","S\xE1bado","Domingo"][e],d=this.especialidadSeleccionada&&this.medicoSeleccionado.disponibilidad?.[this.especialidadSeleccionada]?this.medicoSeleccionado.disponibilidad[this.especialidadSeleccionada]:{};if(!d[s]){this.alert.mostrarError("No hay disponibilidad para el d\xEDa seleccionado."),this.horariosDisponibles=[];return}let u=[],{horaInicio:C,horaFin:v}=d[s],$=this.medicoSeleccionado.duracion||30,y=new Date(`1970-01-01T${C}:00`),se=new Date(`1970-01-01T${v}:00`);for(;y<se;){let m=new Date(y);m.setMinutes(y.getMinutes()+$),u.push(y.toTimeString().split(":").slice(0,2).join(":")),y=m}let le=D(this.firestore,"turnos"),de=F(le,A("medico","==",this.medicoSeleccionado.email)),pe=(yield k(de)).docs.map(m=>m.data()).filter(m=>m.fecha===this.diaSeleccionado).filter(m=>m.estado!=="Cancelado"&&m.estado!=="Rechazado").map(m=>m.horario);this.horariosDisponibles=u.filter(m=>!pe.includes(m))})}seleccionarHorario(i){this.horarioSeleccionado=i}guardarTurno(){return f(this,null,function*(){if(!this.medicoSeleccionado||!this.diaSeleccionado||!this.horarioSeleccionado){this.alert.mostrarError("Debe seleccionar un m\xE9dico, un d\xEDa y un horario.");return}let i={especialidad:this.especialidadSeleccionada,estado:"Pendiente",fecha:this.diaSeleccionado,fechaSolicitud:new Date().toISOString(),horario:this.horarioSeleccionado,medico:this.medicoSeleccionado.email,paciente:this.emailPaciente};try{let e=D(this.firestore,"turnos");yield ie(e,i),this.alert.mostrarSuccess("Turno guardado correctamente."),setTimeout(()=>{this.router.navigate(["/home"])},1500)}catch(e){this.alert.mostrarError("Error al guardar el turno:"+e)}})}static \u0275fac=function(e){return new(e||t)(P(ee),P(oe),P(ne),P(Z))};static \u0275cmp=X({type:t,selectors:[["app-solicitar-turno"]],decls:11,vars:6,consts:[[3,"isLoading"],[1,"banner"],[1,"solicitar-turnos"],["class","pacientes",4,"ngIf"],["class","medicos",4,"ngIf"],["class","especialidades",4,"ngIf"],["class","dias-disponibles",4,"ngIf"],["class","horarios-disponibles",4,"ngIf"],[1,"pacientes"],[1,"tabla-scroll"],[4,"ngIf"],[3,"click",4,"ngFor","ngForOf"],[3,"click"],[1,"medicos"],[1,"medicos-container"],["class","medico",3,"click",4,"ngFor","ngForOf"],[1,"medico",3,"click"],["alt","Imagen del M\xE9dico",3,"src"],[1,"especialidades"],[1,"especialidades-container"],["class","especialidad",3,"selected","click",4,"ngFor","ngForOf"],[1,"especialidad",3,"click"],["alt","Imagen de la Especialidad",3,"src"],[1,"dias-disponibles"],[1,"dias-container"],[1,"horarios-disponibles"],[1,"horarios-container"],[3,"ngClass","click",4,"ngFor","ngForOf"],["style","margin-top: 100px;",3,"disabled","click",4,"ngIf"],[3,"click","ngClass"],[2,"margin-top","100px",3,"click","disabled"]],template:function(e,n){e&1&&(w(0,"app-loading",0),a(1,"section")(2,"div",1)(3,"h2"),l(4,"SOLICITAR TURNOS"),o()()(),a(5,"section",2),g(6,_e,6,3,"section",3)(7,Se,5,2,"section",4)(8,xe,5,2,"section",5)(9,ye,6,3,"section",6)(10,Me,7,4,"section",7),o()),e&2&&(r("isLoading",n.isLoading),c(6),r("ngIf",n.isAdmin&&n.pantallaActual==="pacientes"),c(),r("ngIf",n.emailPaciente&&n.pantallaActual==="medicos"),c(),r("ngIf",n.medicoSeleccionado&&n.pantallaActual==="especialidades"),c(),r("ngIf",n.medicoSeleccionado&&n.especialidadSeleccionada&&n.pantallaActual==="dias"),c(),r("ngIf",n.diaSeleccionado&&n.pantallaActual==="horarios"))},dependencies:[K,Q,W,V],styles:[".solicitar-turnos[_ngcontent-%COMP%]{display:flex;min-height:69vh;justify-content:center;align-items:center}.pacientes[_ngcontent-%COMP%], .medicos[_ngcontent-%COMP%], .especialidades[_ngcontent-%COMP%], .dias-disponibles[_ngcontent-%COMP%], .horarios-disponibles[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center}.medicos-container[_ngcontent-%COMP%], .especialidades-container[_ngcontent-%COMP%], .dias-container[_ngcontent-%COMP%], .horarios-container[_ngcontent-%COMP%]{margin-top:50px;display:flex;flex-direction:row;gap:40px}.medico[_ngcontent-%COMP%], .especialidad[_ngcontent-%COMP%]{text-align:center;cursor:pointer}h4[_ngcontent-%COMP%]{color:#fff;font-family:ubuntu}.medico[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:200px;height:200px;border-radius:50%;object-fit:cover;margin-top:10px}.especialidad[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:200px;height:200px;border-radius:10%;object-fit:cover;margin-top:10px}button[_ngcontent-%COMP%]{background-color:#1d56d1;color:#fff;border:none;padding:10px 20px;border-radius:5px;cursor:pointer;transition:background-color .3s ease}button[_ngcontent-%COMP%]:hover{background-color:#111ba7}button[_ngcontent-%COMP%]:disabled{background-color:#ccc;cursor:not-allowed}.horario-seleccionado[_ngcontent-%COMP%]{background-color:green;color:#fff;border:2px solid darkgreen}p[_ngcontent-%COMP%]{text-align:center;color:#f33;font-weight:700}.especialidad[_ngcontent-%COMP%]{cursor:pointer;border:2px solid transparent;transition:border .3s ease}.especialidad.selected[_ngcontent-%COMP%]{border:2px solid #007bff;border-radius:10px}.tabla-scroll[_ngcontent-%COMP%]{max-height:400px;overflow-y:auto;width:100%;border:1px solid #444;background-color:#555;margin-top:50px}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;margin:0}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:12px;text-align:center;border:1px solid #444}th[_ngcontent-%COMP%]{background-color:#333;color:red}td[_ngcontent-%COMP%]{background-color:#555;color:#fff;cursor:pointer}tr[_ngcontent-%COMP%]:hover, tr[_ngcontent-%COMP%]:hover   td[_ngcontent-%COMP%]{background-color:#8b0000}tr[_ngcontent-%COMP%]:hover   i.fa[_ngcontent-%COMP%]{color:#777}"],data:{animation:[q("fadeInOut",[U("void",x({opacity:0})),E(":enter",[M("300ms ease-in",x({opacity:1}))]),E(":leave",[M("300ms ease-out",x({opacity:0}))])]),q("slideIn",[U("void",x({transform:"translateX(-100%)"})),E(":enter",[M("300ms ease-in",x({transform:"translateX(0)"}))]),E(":leave",[M("300ms ease-out",x({transform:"translateX(100%)"}))])])]}})};var Ee=[{path:"",component:N}],R=class t{static \u0275fac=function(e){return new(e||t)};static \u0275mod=I({type:t});static \u0275inj=O({imports:[H.forChild(Ee),H]})};var ce=class t{static \u0275fac=function(e){return new(e||t)};static \u0275mod=I({type:t});static \u0275inj=O({imports:[Y,R,ae,te,V]})};export{ce as SolicitarTurnoModule};
